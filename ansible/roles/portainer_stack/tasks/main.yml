- name: Create portainer stacks
  ansible.builtin.include_tasks: create_stack.yml
  vars:
    portainer_host: "{{ portainer_api_url }}"
    admin_user: "{{ portainer_admin_user }}"
    admin_password: "{{ portainer_admin_password }}"
    endpoint_id: "{{ portainer_endpoint_id }}"
    stack_name: "{{ item.name }}"
    stack_compose: "{{ lookup('ansible.builtin.template', role_path + '/templates/' + item.file) }}"
    stack_env: "{{ lookup('ansible.builtin.file', role_path + '/files/' + item.env) }}"

  with_items:
    - name: homepage
      file: homepage.yml
      env: homepage.env
    - name: homepage2
      file: homepage2.yml
      env: homepage2.env
